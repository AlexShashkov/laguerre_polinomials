\doxysection{framework.\+h}
\hypertarget{framework_8h_source}{}\label{framework_8h_source}\index{framework/framework.h@{framework/framework.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Александр,\ Дмитрий}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#ifndef\ POLYGEN}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#define\ POLYGEN}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#define\ PR\_NUMBERS\_OF\_ROOTS\_EQUAL\ \ \ \ \ 0}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ PR\_AT\_LEAST\_ONE\_ROOT\_LOST\ \ \ \ -\/1}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#define\ PR\_AT\_LEAST\_ONE\_ROOT\_IS\_FAKE\ -\/2}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ PR\_2\_INFINITE\_ROOTS\ \ \ \ \ \ \ \ \ \ -\/3}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ttmath_8h}{ttmath/ttmath.h}}"{}}\ \textcolor{comment}{//\ Bignum\ C++\ library\ by\ Tomasz\ Sowa}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <numbers>}\ \textcolor{comment}{//\ std::numbers::pi\_v<fp\_t>,\ requires\ -\/std=c++20}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <chrono>}\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <random>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <cstdlib>}\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <cassert>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <iomanip>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <complex>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{comment}{/*\ computes\ (a*b\ -\/\ c*d)\ with\ precision\ not\ worse\ than\ 1.5*(unit\ of\ least\ precision)\ suggested\ in\ Claude-\/Pierre\ Jeannerod,}}
\DoxyCodeLine{00023\ \textcolor{comment}{Nicolas\ Louvet,\ and\ Jean-\/Michel\ Muller,\ "{}Further\ Analysis\ of\ Kahan's\ Algorithm\ for\ the\ Accurate\ Computation\ of\ 2x2\ Determinants"{}.}}
\DoxyCodeLine{00024\ \textcolor{comment}{Mathematics\ of\ Computation,\ Vol.\ 82,\ No.\ 284,\ Oct.\ 2013,\ pp.\ 2245-\/2264\ */}}
\DoxyCodeLine{00025\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ fp\_t>\ \textcolor{keyword}{inline}\ fp\_t\ pr\_product\_difference(fp\_t\ a,\ fp\_t\ b,\ fp\_t\ c,\ fp\_t\ d)}
\DoxyCodeLine{00026\ \{}
\DoxyCodeLine{00027\ \ \ \textcolor{keyword}{auto}\ tmp\ =\ d\ *\ c;}
\DoxyCodeLine{00028\ \ \ \textcolor{keywordflow}{return}\ fma(a,\ b,\ -\/tmp)\ +\ fma(-\/d,\ c,\ tmp);}
\DoxyCodeLine{00029\ \}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ fp\_t>\ }
\DoxyCodeLine{00053\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ generate\_polynomial\_2(}
\DoxyCodeLine{00054\ \textcolor{keywordtype}{unsigned}\ N\_pairs\_of\_complex\_roots,\ }
\DoxyCodeLine{00055\ \textcolor{keywordtype}{unsigned}\ N\_clustered\_roots,\ }
\DoxyCodeLine{00056\ \textcolor{keywordtype}{unsigned}\ N\_multiple\_roots,\ }
\DoxyCodeLine{00057\ fp\_t\ max\_distance\_between\_clustered\_roots,}
\DoxyCodeLine{00058\ fp\_t\ root\_sweep\_low,\ fp\_t\ root\_sweep\_high,}
\DoxyCodeLine{00059\ std::vector<fp\_t>\ \&roots,}
\DoxyCodeLine{00060\ std::vector<fp\_t>\ \&coefficients)}
\DoxyCodeLine{00061\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ seed=std::chrono::system\_clock::now().time\_since\_epoch().count()+std::rand();\ \textcolor{comment}{//\ counts\ milliseconds}}
\DoxyCodeLine{00063\ \ \ \ \ std::mt19937\_64\ rng(seed);\ \textcolor{comment}{//\ randomize\ seed\ from\ the\ clock}}
\DoxyCodeLine{00064\ \ \ \ \ std::uniform\_real\_distribution<fp\_t>\ rnr(root\_sweep\_low,\ root\_sweep\_high);\ \textcolor{comment}{//\ uniform\ random\ data\ generator\ for\ single\ roots}}
\DoxyCodeLine{00065\ \ \ \ \ std::uniform\_real\_distribution<fp\_t>\ rnc(\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L),\ max\_distance\_between\_clustered\_roots);\ \textcolor{comment}{//\ uniform\ random\ data\ generator\ for\ root\ clusters}}
\DoxyCodeLine{00066\ \ \ \ \ fp\_t\ re,\ im,\ root\_mid\_sweep=root\_sweep\_low+0.5*(root\_sweep\_high-\/root\_sweep\_low);}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\ RE,\ IM;\ \textcolor{comment}{//\ high-\/precisioon\ counterparts\ of\ re,\ im}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordflow}{if}\ (N\_pairs\_of\_complex\_roots==1)\ \textcolor{comment}{//\ no\ real\ roots}}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ re=rnr(rng);\ \textcolor{keywordflow}{while}\ ((im=rnr(rng))==\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L))\ \{\}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ RE=re;\ IM=im;}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ coefficients[1]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(-\/2.0L*RE);\ \textcolor{comment}{//\ -\/2*re}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ coefficients[0]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(pr\_product\_difference(RE,\ RE,\ -\/IM,\ IM));\ \textcolor{comment}{//\ re*re+im*im}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_clustered\_roots==2)\{\ \textcolor{comment}{//\ 2\ close\ but\ distinct\ roots}}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ roots[0]=re=rnr(rng);\ \textcolor{keywordflow}{while}\ ((im=rnc(rng))==\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L))\ \{\}\ roots[1]=im=(re>=root\_mid\_sweep\ ?\ re-\/im\ :\ re+im);\ }
\DoxyCodeLine{00079\ \ \ \ \ \}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_multiple\_roots==2)\{\ \textcolor{comment}{//\ double\ root\ counted\ as\ a\ single\ root}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ roots[1]=roots[0]=im=re=rnr(rng);}
\DoxyCodeLine{00082\ \ \ \ \ \}}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordflow}{else}\{\ \textcolor{comment}{//\ 2\ distinct\ single\ roots}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ roots[0]=re=rnr(rng);\ \textcolor{keywordflow}{while}\ ((im=rnr(rng))==re)\ \{\}\ roots[1]=im=rnr(rng);\ }
\DoxyCodeLine{00085\ \ \ \ \ \}}
\DoxyCodeLine{00086\ \ \ \ \ RE=re;\ }
\DoxyCodeLine{00087\ \ \ \ \ IM=im;}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ coefficients[1]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(\ -\/RE-\/IM\ );}
\DoxyCodeLine{00090\ \ \ \ \ coefficients[0]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(\ RE*IM\ );}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{return}\ 2;}
\DoxyCodeLine{00092\ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00115\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ fp\_t>\ }
\DoxyCodeLine{00116\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ generate\_polynomial\_3(}
\DoxyCodeLine{00117\ \textcolor{keywordtype}{unsigned}\ N\_pairs\_of\_complex\_roots,}
\DoxyCodeLine{00118\ \textcolor{keywordtype}{unsigned}\ N\_clustered\_roots,}
\DoxyCodeLine{00119\ \textcolor{keywordtype}{unsigned}\ N\_multiple\_roots,}
\DoxyCodeLine{00120\ fp\_t\ max\_distance\_between\_clustered\_roots,}
\DoxyCodeLine{00121\ fp\_t\ root\_sweep\_low,\ fp\_t\ root\_sweep\_high,}
\DoxyCodeLine{00122\ std::vector<fp\_t>\ \&roots,}
\DoxyCodeLine{00123\ std::vector<fp\_t>\ \&coefficients)}
\DoxyCodeLine{00124\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ seed=std::chrono::system\_clock::now().time\_since\_epoch().count()+std::rand();\ \textcolor{comment}{//\ counts\ milliseconds}}
\DoxyCodeLine{00126\ \ \ \ \ std::mt19937\_64\ rng(seed);\ \textcolor{comment}{//\ randomize\ seed\ from\ the\ clock}}
\DoxyCodeLine{00127\ \ \ \ \ std::uniform\_real\_distribution<fp\_t>\ rnr(root\_sweep\_low,\ root\_sweep\_high);\ \textcolor{comment}{//\ uniform\ random\ data\ generator\ for\ single\ roots}}
\DoxyCodeLine{00128\ \ \ \ \ std::uniform\_real\_distribution<fp\_t>\ rnc(\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L),\ max\_distance\_between\_clustered\_roots);\ \textcolor{comment}{//\ uniform\ random\ data\ generator\ for\ root\ clusters}}
\DoxyCodeLine{00129\ \ \ \ \ fp\_t\ re,\ im,\ u,\ root\_mid\_sweep=root\_sweep\_low+0.5*(root\_sweep\_high-\/root\_sweep\_low);}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\ RE,\ IM,\ U,\ V;\ \textcolor{comment}{//\ high-\/precisioon\ counterparts\ of\ re,\ im,\ u,\ v\ //TODO:\ BIGNUM}}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordflow}{if}\ (N\_pairs\_of\_complex\_roots==1)\ \textcolor{comment}{//\ one\ real\ root}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ re=rnr(rng);\ \textcolor{keywordflow}{while}\ ((im=rnr(rng))==\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L))\ \{\}\ roots[0]=u=rnr(rng);}
\DoxyCodeLine{00134\ \ \ \ \ \ \ RE=re;\ IM=im;\ U=u;}
\DoxyCodeLine{00135\ \ \ }
\DoxyCodeLine{00136\ \ \ \ \ \ \ IM=pr\_product\_difference(RE,\ RE,\ -\/IM,\ IM);\ \textcolor{comment}{//\ re*re+im*im}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ RE*=-\/2.0L;\ \textcolor{comment}{//\ irreducible\ quadratic\ polynomial\ is\ (x\string^2\ +\ re*x\ +\ im);\ multiply\ it\ by\ (x-\/u)}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ coefficients[0]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(-\/IM*U);\ coefficients[2]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(RE-\/U);}
\DoxyCodeLine{00139\ \ \ \ \ \ \ coefficients[1]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(std::fma(-\/RE,U,IM));\ \textcolor{comment}{//\ im-\/re*u;\ }}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_clustered\_roots==3)\ \textcolor{comment}{//\ 3\ clustered\ distinct\ roots}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00144\ \ \ \ \ \ \ roots[0]=re=rnr(rng);\ \textcolor{keywordflow}{while}\ ((im=rnc(rng))==\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L))\ \{\}\ \textcolor{keywordflow}{while}((u=rnc(rng))==\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L))\ \{\}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ roots[1]=im=(re>root\_mid\_sweep\ ?\ roots[2]=u=(re-\/im-\/u),\ re-\/im\ :\ roots[2]=u=(re+im+u),\ re+im);}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_clustered\_roots==2)\ \textcolor{comment}{//\ 2\ clustered\ roots,\ 1\ single\ root;\ all\ distinct}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ roots[0]=re=rnr(rng);\ \textcolor{keywordflow}{while}((im=rnc(rng))==\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L))\ \{\}}
\DoxyCodeLine{00150\ \ \ \ \ \ \ roots[1]=im=(re>root\_mid\_sweep\ ?\ re-\/im\ :\ re+im);\ \textcolor{keywordflow}{do}\ \{\ roots[2]=u=rnr(rng);\ \}\ \textcolor{keywordflow}{while}\ (u==re\ ||\ u==roots[1]);}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_multiple\_roots==3)\ \textcolor{comment}{//\ triple\ root\ counted\ as\ a\ single\ root}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \{\ roots[2]=roots[1]=roots[0]=u=im=re=rnr(rng);\ \}}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_multiple\_roots==2)\ \textcolor{comment}{//\ double\ root\ and\ 1\ single\ root;\ totally\ 2\ roots}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \{\ roots[1]=roots[0]=im=re=rnr(rng);\ \textcolor{keywordflow}{while}\ ((roots[2]=u=rnr(rng))==re)\ \{\}\ \}}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ 3\ distinct\ single\ roots}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \{\ roots[0]=re=rnr(rng);\ \textcolor{keywordflow}{while}\ ((roots[1]=im=rnr(rng))==re)\ \{\}\ \textcolor{keywordflow}{do}\ \{\ roots[2]=u=rnr(rng);\ \}\ \textcolor{keywordflow}{while}(u==re\ ||\ u==im);\ \}}
\DoxyCodeLine{00158\ \ \ \ \ RE=re;\ IM=im;\ U=u;}
\DoxyCodeLine{00159\ \ \ \ \ coefficients[2]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(-\/RE-\/IM-\/U);\ coefficients[0]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(-\/RE*IM*U);}
\DoxyCodeLine{00160\ \ \ \ \ V=pr\_product\_difference(RE,IM,-\/RE,U);\ coefficients[1]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(std::fma(IM,U,V));\ \textcolor{comment}{//\ re*im+re*u+im*u=im*u+(re*im-\/(-\/re*u));}}
\DoxyCodeLine{00161\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Generated\ 3\ roots!\(\backslash\)n"{}};}
\DoxyCodeLine{00162\ \ \ \ \ std::cout\ <<\ roots[0]\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ roots[1]\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ roots[2]\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordflow}{return}\ 3;}
\DoxyCodeLine{00164\ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00187\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ fp\_t>\ }
\DoxyCodeLine{00188\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ generate\_polynomial\_4(}
\DoxyCodeLine{00189\ \textcolor{keywordtype}{unsigned}\ N\_pairs\_of\_complex\_roots,}
\DoxyCodeLine{00190\ \textcolor{keywordtype}{unsigned}\ N\_clustered\_roots,}
\DoxyCodeLine{00191\ \textcolor{keywordtype}{unsigned}\ N\_multiple\_roots,}
\DoxyCodeLine{00192\ fp\_t\ max\_distance\_between\_clustered\_roots,}
\DoxyCodeLine{00193\ fp\_t\ root\_sweep\_low,\ fp\_t\ root\_sweep\_high,}
\DoxyCodeLine{00194\ std::vector<fp\_t>\ \&roots,}
\DoxyCodeLine{00195\ std::vector<fp\_t>\ \&coefficients)}
\DoxyCodeLine{00196\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ seed=std::chrono::system\_clock::now().time\_since\_epoch().count()+std::rand();\ \textcolor{comment}{//\ counts\ milliseconds}}
\DoxyCodeLine{00198\ \ \ \ \ std::mt19937\_64\ rng(seed);\ \textcolor{comment}{//\ randomize\ seed\ from\ the\ clock}}
\DoxyCodeLine{00199\ \ \ \ \ std::uniform\_real\_distribution<fp\_t>\ rnr(root\_sweep\_low,\ root\_sweep\_high);\ \textcolor{comment}{//\ uniform\ random\ data\ generator\ for\ single\ roots}}
\DoxyCodeLine{00200\ \ \ \ \ std::uniform\_real\_distribution<fp\_t>\ rnc(\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L),\ max\_distance\_between\_clustered\_roots);\ \textcolor{comment}{//\ uniform\ random\ data\ generator\ for\ root\ clusters}}
\DoxyCodeLine{00201\ \ \ \ \ fp\_t\ re,\ im,\ u,\ v,\ root\_mid\_sweep=root\_sweep\_low+0.5*(root\_sweep\_high-\/root\_sweep\_low);}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\ RE,\ IM,\ U,\ V,\ TMP;\ \textcolor{comment}{//\ high-\/precisioon\ counterparts\ of\ re,\ im,\ u,\ v}}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordflow}{if}\ (N\_pairs\_of\_complex\_roots==2)\ \textcolor{comment}{//\ no\ real\ roots}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ re=rnr(rng);\ \textcolor{keywordflow}{while}(std::abs(im=rnr(rng))<std::abs(re))\ \{\}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ RE=re;\ }
\DoxyCodeLine{00207\ \ \ \ \ \ \ IM=im;}
\DoxyCodeLine{00208\ \ \ \ \ \ \ IM=pr\_product\_difference(RE,RE,-\/IM,IM);\ \textcolor{comment}{//\ RE*RE+IM*IM}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ RE*=-\/2.0L;\ \textcolor{comment}{//\ irreducible\ quadratic\ polynomial\ is\ (x\string^2\ +\ re*x\ +\ im)}}
\DoxyCodeLine{00210\ \ \ \ \ \ \ u=rnr(rng);\ \textcolor{keywordflow}{while}(std::abs(v=rnr(rng))<std::abs(u))\ \{\}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ U=u;\ V=v;}
\DoxyCodeLine{00212\ \ \ \ \ \ \ V=pr\_product\_difference(U,U,-\/V,V);\ \textcolor{comment}{//\ U*U+V*V}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ U*=-\/2.0L;\ \textcolor{comment}{//\ irreducible\ quadratic\ polynomial\ is\ (x\string^2\ +\ u*x\ +\ v)}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \textcolor{comment}{//\ multiply\ both\ irreducible\ quadrics}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ coefficients[0]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(IM*V);\ coefficients[1]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(pr\_product\_difference(RE,V,-\/IM,U));\ \textcolor{comment}{//\ RE*V+IM*U;}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ coefficients[2]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(std::fma(RE,U,IM+V));\ \textcolor{comment}{//\ IM+RE*U+V}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ coefficients[3]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(RE+U);}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_pairs\_of\_complex\_roots==1)\ \textcolor{comment}{//\ two\ real\ roots}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ re=rnr(rng);\ \textcolor{keywordflow}{while}(std::abs(im=rnr(rng))<std::abs(re))\ \{\}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ RE=re;\ IM=im;}
\DoxyCodeLine{00225\ \ \ \ \ \ \ IM=pr\_product\_difference(RE,RE,-\/IM,IM);\ \textcolor{comment}{//\ RE*RE+IM*IM}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ RE*=-\/2.0L;\ \textcolor{comment}{//\ irreducible\ quadratic\ polynomial\ is\ (x\string^2\ +\ re*x\ +\ im);\ multiply\ it\ by\ the\ rest}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \textcolor{comment}{//\ 2\ real\ roots\ follow}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (N\_clustered\_roots==2)\ \textcolor{comment}{//\ 2\ clustered\ roots}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \{\ roots[0]=u=rnr(rng);\ v=rnc(rng);\ roots[1]=v=(u>root\_mid\_sweep\ ?\ u-\/v\ :\ u+v);\ \}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_multiple\_roots==2)\ \textcolor{comment}{//\ 2\ multiple\ roots}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \{\ roots[1]=roots[0]=u=v=rnr(rng);\ \}}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ 2\ distinct\ roots}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \{\ roots[0]=u=rnr(rng);\ roots[1]=v=rnr(rng);\ \}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ U=u;\ V=v;}
\DoxyCodeLine{00235\ \ \ \ \ \ \ TMP=-\/U-\/V;\ V*=U;\ U=TMP;\ \textcolor{comment}{//\ two-\/real-\/root\ quadratic\ polynomial\ is\ (x\string^2\ +\ u*x\ +\ v)}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \textcolor{comment}{//\ multiply\ irreducible\ and\ reducible\ quadrics}}
\DoxyCodeLine{00237\ \ \ \ \ \ \ coefficients[0]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(IM*V);\ coefficients[1]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(pr\_product\_difference(RE,V,-\/IM,U));\ \textcolor{comment}{//\ RE*V+IM*U}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ coefficients[2]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(std::fma(RE,U,IM+V));\ \textcolor{comment}{//\ IM+RE*U+V}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ coefficients[3]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(RE+U);}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 2;}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_clustered\_roots==4)\ \textcolor{comment}{//\ 4\ clustered\ roots}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00244\ \ \ \ \ \ \ roots[0]=re=rnr(rng);\ im=rnc(rng);\ u=rnc(rng);\ v=rnc(rng);}
\DoxyCodeLine{00245\ \ \ \ \ \ \ roots[1]=im=(re>root\_mid\_sweep\ ?\ (roots[3]=v=(re-\/im-\/u-\/v),\ roots[2]=u=(re-\/im-\/u),\ re-\/im)\ :}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (roots[3]=v=(re+im+u+v),\ roots[2]=u=(re+im+u),\ re+im)\ );}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_clustered\_roots==3)\ \textcolor{comment}{//\ 3\ clustered\ roots\ and\ 1\ single\ root}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ roots[0]=re=rnr(rng);\ im=rnc(rng);\ u=rnc(rng);}
\DoxyCodeLine{00251\ \ \ \ \ \ \ roots[1]=im=(re>root\_mid\_sweep\ ?\ (roots[2]=u=(re-\/im-\/u),\ re-\/im)\ :\ (roots[2]=u=(re+im+u),\ re+im)\ );}
\DoxyCodeLine{00252\ \ \ \ \ \ \ roots[3]=v=rnr(rng);\ \textcolor{comment}{//\ a\ single\ root}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_clustered\_roots==2)\ \textcolor{comment}{//\ 2\ clustered\ roots}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00256\ \ \ \ \ \ \ roots[0]=re=rnr(rng);\ im=rnc(rng);\ roots[1]=im=(re>root\_mid\_sweep\ ?\ re-\/im\ :\ re+im);}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (N\_multiple\_roots==2)\ \textcolor{comment}{//\ 2\ multiple\ roots}}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \{\ roots[3]=roots[2]=v=u=rnr(rng);\ \}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ 2\ single\ roots}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \{\ roots[2]=u=rnr(rng);\ roots[3]=v=rnr(rng);\ \}}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_multiple\_roots==4)\ \textcolor{comment}{//\ 4\ multiple\ roots}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \{\ roots[3]=roots[2]=roots[1]=roots[0]=v=u=im=re=rnr(rng);\ \}}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_multiple\_roots==3)\ \textcolor{comment}{//\ 3\ multiple\ roots\ and\ 1\ single\ root}}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \{\ roots[2]=roots[1]=roots[0]=u=im=re=rnr(rng);\ roots[3]=v=rnr(rng);\ \}}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (N\_multiple\_roots==2)\ \textcolor{comment}{//\ 2\ multiple\ roots\ and\ 2\ single\ roots}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \{\ roots[1]=roots[0]=im=re=rnr(rng);\ roots[2]=u=rnr(rng);\ roots[3]=v=rnr(rng);\ \}}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ 4\ distinct\ single\ roots}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \{\ roots[0]=re=rnr(rng);\ roots[1]=im=rnr(rng);\ roots[2]=u=rnr(rng);\ roots[3]=v=rnr(rng);\ \}}
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{comment}{//\ compute\ coefficients\ from\ 4\ roots:\ re,\ im,\ u,\ v}}
\DoxyCodeLine{00271\ \ \ \ \ RE=re;\ IM=im;\ U=u;\ V=v;}
\DoxyCodeLine{00272\ \ \ \ \ TMP=-\/RE-\/IM;\ IM*=RE;\ RE=TMP;\ \textcolor{comment}{//\ now\ we\ have\ the\ 1.st\ quadratic\ polynomial:\ x\string^2\ +\ x*re\ +\ im}}
\DoxyCodeLine{00273\ \ \ \ \ TMP=-\/U-\/V;\ V*=U;\ U=TMP;\ \textcolor{comment}{//\ now\ we\ have\ the\ 2.nd\ quadratic\ polynomial:\ x\string^2\ +\ x*u\ +\ v}}
\DoxyCodeLine{00274\ \ \ \ \ coefficients[0]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(IM*V);\ coefficients[1]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(pr\_product\_difference(RE,V,-\/IM,U));\ \textcolor{comment}{//\ RE*V+IM*U}}
\DoxyCodeLine{00275\ \ \ \ \ coefficients[2]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(std::fma(RE,U,IM+V));\ \textcolor{comment}{//\ IM+RE*U+V}}
\DoxyCodeLine{00276\ \ \ \ \ coefficients[3]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(RE+U);\ }
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordflow}{return}\ 4;}
\DoxyCodeLine{00278\ \}}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00304\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ fp\_t,\ \textcolor{keywordtype}{int}\ exponent,\ \textcolor{keywordtype}{int}\ mantissa>\ }
\DoxyCodeLine{00305\ \textcolor{keywordtype}{int}\ generate\_polynomial(}
\DoxyCodeLine{00306\ \textcolor{keywordtype}{unsigned}\ P,}
\DoxyCodeLine{00307\ \textcolor{keywordtype}{unsigned}\ N\_pairs\_of\_complex\_roots,}
\DoxyCodeLine{00308\ \textcolor{keywordtype}{unsigned}\ N\_clustered\_roots,}
\DoxyCodeLine{00309\ \textcolor{keywordtype}{unsigned}\ N\_multiple\_roots,}
\DoxyCodeLine{00310\ fp\_t\ max\_distance\_between\_clustered\_roots,}
\DoxyCodeLine{00311\ fp\_t\ root\_sweep\_low,\ fp\_t\ root\_sweep\_high,}
\DoxyCodeLine{00312\ std::vector<fp\_t>\ \&roots,}
\DoxyCodeLine{00313\ std::vector<fp\_t>\ \&coefficients)}
\DoxyCodeLine{00314\ \{}
\DoxyCodeLine{00315\ \textcolor{keywordtype}{int}\ n\_simple\_roots=P-\/2*N\_pairs\_of\_complex\_roots-\/N\_clustered\_roots-\/N\_multiple\_roots;}
\DoxyCodeLine{00316\ assert(N\_clustered\_roots!=1);\ assert(N\_multiple\_roots!=1);\ assert(n\_simple\_roots>=0);\ assert(P>0);}
\DoxyCodeLine{00317\ assert(max\_distance\_between\_clustered\_roots>\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L));}
\DoxyCodeLine{00318\ assert(root\_sweep\_high-\/root\_sweep\_low>2*P*max\_distance\_between\_clustered\_roots);}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ coefficients[P]=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(1.0L);\ \textcolor{comment}{//\ invariant}}
\DoxyCodeLine{00321\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ seed=std::chrono::system\_clock::now().time\_since\_epoch().count()+std::rand();\ \textcolor{comment}{//\ counts\ milliseconds}}
\DoxyCodeLine{00322\ std::mt19937\_64\ rng(seed);\ \textcolor{comment}{//\ randomize\ seed\ from\ the\ clock}}
\DoxyCodeLine{00323\ std::uniform\_real\_distribution<fp\_t>\ rnr(root\_sweep\_low,\ root\_sweep\_high);\ }
\DoxyCodeLine{00324\ std::uniform\_real\_distribution<fp\_t>\ rnc(\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L),\ max\_distance\_between\_clustered\_roots);\ \textcolor{comment}{//\ uniform\ random\ data\ generator\ for\ root\ clusters}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ fp\_t\ re,\ im,\ root\_mid\_sweep=root\_sweep\_low+0.5*(root\_sweep\_high-\/root\_sweep\_low);}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \textcolor{keywordflow}{switch}\ (P)}
\DoxyCodeLine{00329\ \ \ \{}
\DoxyCodeLine{00330\ \ \ \textcolor{keywordflow}{case}\ 0:}
\DoxyCodeLine{00331\ \ \ \ \ coefficients[0]=rnr(rng);\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00332\ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00333\ \ \ \ \ coefficients[0]=-\/(roots[0]=rnr(rng));\ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00334\ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00335\ \ \ \ \ \{}
\DoxyCodeLine{00336\ \ \ \ \ \ \textcolor{keywordflow}{return}\ generate\_polynomial\_2(N\_pairs\_of\_complex\_roots,\ N\_clustered\_roots,\ N\_multiple\_roots,\ max\_distance\_between\_clustered\_roots,\ }
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ root\_sweep\_low,\ root\_sweep\_high,\ roots,\ coefficients);}
\DoxyCodeLine{00338\ \ \ \ \ \}}
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{case}\ 3:}
\DoxyCodeLine{00340\ \ \ \ \ \{}
\DoxyCodeLine{00341\ \ \ \ \ \ \textcolor{keywordflow}{return}\ generate\_polynomial\_3(N\_pairs\_of\_complex\_roots,\ N\_clustered\_roots,\ N\_multiple\_roots,\ max\_distance\_between\_clustered\_roots,\ }
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ root\_sweep\_low,\ root\_sweep\_high,\ roots,\ coefficients);}
\DoxyCodeLine{00343\ \ \ \ \ \}\ \textcolor{comment}{//\ P=3}}
\DoxyCodeLine{00344\ \ \ \textcolor{keywordflow}{case}\ 4:\ \textcolor{comment}{//\ DEN\ DEBUG:\ check\ it\ carefully\ and\ perform\ calculation\ of\ coefficients\ in\ long\ double}}
\DoxyCodeLine{00345\ \ \ \ \ \{}
\DoxyCodeLine{00346\ \ \ \ \ \ \textcolor{keywordflow}{return}\ generate\_polynomial\_4(N\_pairs\_of\_complex\_roots,\ N\_clustered\_roots,\ N\_multiple\_roots,\ max\_distance\_between\_clustered\_roots,\ }
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ root\_sweep\_low,\ root\_sweep\_high,\ roots,\ coefficients);}
\DoxyCodeLine{00348\ \ \ \ \ \}\ \textcolor{comment}{//\ P=4}}
\DoxyCodeLine{00349\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00350\ \ \ \textcolor{comment}{//\ More\ than\ 4\ roots,\ no\ general\ formula.}}
\DoxyCodeLine{00351\ \ \ \ \ \{}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Generate\ first\ 4\ roots\ and\ coefficients}}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ which\ 4\ roots\ will\ be\ calculated\ first\ without\ using\ bignum}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ roots\_left\ =\ 4,\ roots\_generated\_by\_old=0;}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ first4\_clustered\_roots\ \ \ =\ N\_clustered\_roots\ <=\ 4\ ?\ N\_clustered\_roots\ :\ 0;}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ first4\_multiple\_roots\ \ \ \ =\ (N\_multiple\_roots\ <=\ 4\ \&\&\ first4\_clustered\_roots\ ==\ 0)?\ N\_multiple\_roots\ :\ 0;}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ roots\_left\ -\/=\ (first4\_clustered\_roots\ +\ first4\_multiple\_roots);}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ first4\_complex\_roots\ \ \ \ \ =\ roots\_left\ >=\ 2\ \&\&\ N\_pairs\_of\_complex\_roots\ >\ 0\ ?\ (\ roots\_left\ <\ 4\ ||\ N\_pairs\_of\_complex\_roots==1\ ?\ 1:\ 2\ ):0;}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ first4\_complex\_roots\_cnt\ =\ first4\_complex\_roots*2;}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ first4\_simple\_roots\ \ \ \ \ \ =\ std::min<int>(n\_simple\_roots,\ roots\_left\ -\/\ first4\_complex\_roots\_cnt);}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ roots\_generated\_by\_old\ =\ first4\_clustered\_roots+first4\_multiple\_roots+first4\_complex\_roots\_cnt+first4\_simple\_roots;}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Roots\ that\ will\ be\ generated\ by\ generate\_polynomial\_n:\ "{}}\ <<\ roots\_generated\_by\_old;}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)nclustered:\ "{}}\ <<\ first4\_clustered\_roots;}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)nmultiple:\ "{}}\ <<\ first4\_multiple\_roots;}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)ncomplex:\ "{}}\ <<\ first4\_complex\_roots\_cnt;}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)nsimple:\ "{}}\ <<\ first4\_simple\_roots\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ std::vector<fp\_t>\ coefficients4(4,\ 0);}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ crnt\_idx=0;}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(roots\_generated\_by\_old)\{}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ crnt\_idx\ =\ generate\_polynomial\_4(first4\_complex\_roots,\ first4\_clustered\_roots,\ first4\_multiple\_roots,\ max\_distance\_between\_clustered\_roots,\ }
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ root\_sweep\_low,\ root\_sweep\_high,\ roots,\ coefficients4);}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ std::copy(coefficients4.begin(),\ coefficients4.end(),\ coefficients.end()\ -\/\ coefficients4.size()-\/1);}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Roots\ that\ will\ be\ generated\ by\ convolution:\ "{}}\ <<\ P\ -\/\ roots\_generated\_by\_old\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\ \&el\ :\ coefficients4)\{}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout<<\ el\ <<\ \textcolor{charliteral}{','};}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00386\ \textcolor{comment}{\ \ \ \ \ \ \ \ std::cout\ <<\ "{}\(\backslash\)nr\ "{};}}
\DoxyCodeLine{00387\ \textcolor{comment}{}}
\DoxyCodeLine{00388\ \textcolor{comment}{\ \ \ \ \ \ \ \ for(auto\ \&el\ :\ roots)\{}}
\DoxyCodeLine{00389\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ std::cout<<\ el\ <<\ ',';}}
\DoxyCodeLine{00390\ \textcolor{comment}{\ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{00391\ \textcolor{comment}{\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ current\ root\ id}}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ re\ =\ rnr(rng);\ \textcolor{comment}{//\ Generate\ the\ first\ root}}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)nBASIC\ GEN\ "{}\ <<\ re;}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ Generate\ last\ clustered\ roots}}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)nGenerating\ roots\ after\ finding\ basic\ n.\ \(\backslash\)nGenerating\ clustered\ roots:\ "{}\ <<\ \ N\_clustered\_roots-\/first4\_clustered\_roots;}}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ N\_clustered\_roots-\/first4\_clustered\_roots;\ ++i)\ \{}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ rnc(rng);\ \textcolor{comment}{//\ Generate\ a\ small\ random\ number}}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \ \ re\ =\ roots[crnt\_idx++]\ =\ (re\ >\ root\_mid\_sweep)\ ?\ re\ -\/\ im\ :\ re\ +\ im;\ \textcolor{comment}{//\ Generate\ the\ next\ root\ close\ to\ the\ previous\ one}}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Generate\ multiple\ roots}}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)nGenerating\ multiple\ roots:\ "{}\ <<\ \ N\_multiple\_roots-\/first4\_multiple\_roots;}}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ re\ =\ N\_clustered\_roots\ !=\ first4\_clustered\_roots\ ?\ rnr(rng):\ re;}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ roots\_left\ =\ crnt\_idx;}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ roots\_left;\ i\ <\ roots\_left\ +\ N\_multiple\_roots-\/first4\_multiple\_roots;\ ++i)\{}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ roots[crnt\_idx++]\ =\ re;}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Finally,\ generate\ last\ simple\ roots}}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)nGenerating\ simple\ roots:\ "{}\ <<\ \ n\_simple\_roots-\/first4\_simple\_roots;}}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)n\ FROM\ "{}\ <<\ crnt\_idx\ <<\ "{}\ TO\ "{}\ <<\ crnt\_idx\ +\ n\_simple\_roots-\/first4\_simple\_roots;}}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ crnt\_idx;\ i\ <\ crnt\_idx\ +\ n\_simple\_roots-\/first4\_simple\_roots;\ ++i)\{}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \ \ roots[i]\ =\ rnr(rng);}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)n\ REGEN\ ROOTS\ "{};}}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00423\ \textcolor{comment}{\ \ \ \ \ \ \ \ for(auto\ \&el\ :\ roots)\{}}
\DoxyCodeLine{00424\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ std::cout<<\ el\ <<\ ',';}}
\DoxyCodeLine{00425\ \textcolor{comment}{\ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{00426\ \textcolor{comment}{\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ resulting\ coefficients}}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ std::vector<ttmath::Big<exponent,mantissa>>\ big\_coeffs;}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ fp\_t\ num\ :\ coefficients)\ \{}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classttmath_1_1Big}{ttmath::Big<exponent,mantissa>}}\ bignum(num);}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ \ \ big\_coeffs.push\_back(bignum);}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ std::vector<ttmath::Big<exponent,mantissa>>\ big\_coeffs\_new\ =\ big\_coeffs;}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ std::vector<ttmath::Big<exponent,mantissa>>\ big\_roots;}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ fp\_t\ num\ :\ roots)\ \{}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classttmath_1_1Big}{ttmath::Big<exponent,mantissa>}}\ bignum(num);}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ big\_roots.push\_back(bignum);}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ roots\_generated\_by\_old;\ i\ <\ P-\/first4\_complex\_roots\_cnt;\ ++i)\{}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)nROOT\ \#"{}\ <<\ i\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ P-\/2;\ j\ >=\ 0;\ -\/-\/j)\{}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}j:"{}\ <<\ j\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}-\/coeff[j+1]:"{}\ <<\ -\/big\_coeffs[j+1]\ <<\ "{};\ roots[i]:"{}\ <<\ big\_roots[i]\ <<\ "{};\ "{}\ <<\ "{}coeff[j]:\ "{}\ <<\ big\_coeffs[j];}}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{};\ fma:\ "{}\ <<\ std::fma(-\/big\_coeffs[j+1].ToDouble(),\ big\_roots[i].ToDouble(),\ big\_coeffs[j].ToDouble());}}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ big\_coeffs\_new[j]\ =\ \mbox{\hyperlink{classttmath_1_1Big}{ttmath::Big<exponent,mantissa>}}(std::fma(-\/big\_coeffs[j+1].ToDouble(),\ big\_roots[i].ToDouble(),\ big\_coeffs[j].ToDouble()));}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)n\ coeff\_new[j]:"{}\ <<\ big\_coeffs\_new[j]\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \ \ big\_coeffs\_new[P-\/1]\ -\/=\ big\_roots[i];}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)ncoeff\_new[P-\/1]:\ "{}\ <<\ big\_coeffs\_new[P-\/1];}}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ coefficients\ =\ coefficients\_new;}}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ big\_coeffs\ =\ big\_coeffs\_new;}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00460\ }
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Generate\ last\ complex\ roots}}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)nGenerating\ complex\ roots:\ "{}\ <<\ \ N\_pairs\_of\_complex\_roots\ -\/\ first4\_complex\_roots\ <<\ "{}\ pairs"{};}}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ N\_pairs\_of\_complex\_roots\ -\/\ first4\_complex\_roots;\ ++i)\ \{}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ re=rnr(rng);\ \textcolor{keywordflow}{while}\ ((im=rnr(rng))==\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(0.0L))\ \{\}}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ c1=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(-\/2.0L*re);\ \textcolor{comment}{//\ -\/2*re}}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ c2=\textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(pr\_product\_difference(re,\ re,\ -\/im,\ im));\ \textcolor{comment}{//\ re*re+im*im}}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ P-\/2;\ j\ >=\ 0;\ -\/-\/j)\{}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ big\_coeffs\_new[j]\ =\ \mbox{\hyperlink{classttmath_1_1Big}{ttmath::Big<exponent,mantissa>}}(std::fma(big\_coeffs[j].ToDouble(),\ c1,}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::fma(big\_coeffs[j+1].ToDouble(),\ c2,\ big\_coeffs[j+2].ToDouble())));}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ big\_coeffs\_new[P-\/first4\_complex\_roots\_cnt]\ *=\ \mbox{\hyperlink{classttmath_1_1Big}{ttmath::Big<exponent,mantissa>}}(c2)\ ;\ \textcolor{comment}{//\ first\ not\ null\ element}}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ big\_coeffs\ =\ big\_coeffs\_new;}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)nIM:\ "{}\ <<\ im\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ roots[P-\/i*2-\/1]\ =\ re;\ //\ In\ future\ we\ can\ add\ support\ of\ complex\ numbers\ }}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ roots[P-\/i*2-\/2]\ =\ re;}}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i\ <\ P+1;\ ++i)\ \{}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ \ \ coefficients[i]\ =\ \textcolor{keyword}{static\_cast<}fp\_t\textcolor{keyword}{>}(big\_coeffs[i].ToDouble());}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ P\ -\/\ (N\_pairs\_of\_complex\_roots*2);}
\DoxyCodeLine{00482\ \ \ \ \ \}}
\DoxyCodeLine{00483\ \ \ \}}
\DoxyCodeLine{00484\ \textcolor{keywordflow}{return}\ -\/1;\ \textcolor{comment}{//\ unreachable,\ means\ a\ flaw\ in\ control\ here}}
\DoxyCodeLine{00485\ \}}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00504\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ fp\_t>\ }
\DoxyCodeLine{00505\ \textcolor{keywordtype}{int}\ compare\_roots(}
\DoxyCodeLine{00506\ \textcolor{keywordtype}{unsigned}\ N\_roots\_to\_check,}
\DoxyCodeLine{00507\ \textcolor{keywordtype}{unsigned}\ N\_roots\_ground\_truth,}
\DoxyCodeLine{00508\ std::vector<fp\_t>\ \&roots\_to\_check,}
\DoxyCodeLine{00509\ std::vector<fp\_t>\ \&roots\_ground\_truth,}
\DoxyCodeLine{00510\ fp\_t\ \&max\_absolute\_error,}
\DoxyCodeLine{00511\ fp\_t\ \&max\_relative\_error)\{}
\DoxyCodeLine{00512\ \ \ \ \ \textcolor{keywordtype}{int}\ rv\ =\ (N\_roots\_to\_check<N\_roots\_ground\_truth)\ ?\ PR\_AT\_LEAST\_ONE\_ROOT\_LOST\ :}
\DoxyCodeLine{00513\ \ \ \ \ \ \ (\ (N\_roots\_to\_check>N\_roots\_ground\_truth)\ ?\ PR\_AT\_LEAST\_ONE\_ROOT\_IS\_FAKE\ :\ PR\_NUMBERS\_OF\_ROOTS\_EQUAL\ );}
\DoxyCodeLine{00514\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\ abs\ =\ std::numeric\_limits<long\ double\ >::max();}
\DoxyCodeLine{00515\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\ \ rel\ =\ std::numeric\_limits<long\ double\ >::max();}
\DoxyCodeLine{00516\ \ \ \ \ \textcolor{keyword}{auto}\ size\ =\ roots\_to\_check.size();}
\DoxyCodeLine{00517\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j\ =\ 0;j<size;\ j++)}
\DoxyCodeLine{00518\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;i\ <\ size;\ i++)\{}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\ \ absLoc\ =\ std::abs((\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double})(roots\_ground\_truth[i])-\/(\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double})(roots\_to\_check[(i\ +\ j)\ \%\ size]));}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ abs\ =\ std::min(absLoc,abs);}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ rel\ =\ std::min(std::abs(}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double})(absLoc\ +\ std::numeric\_limits<fp\_t>::epsilon())/}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double})(std::max(roots\_to\_check[(i\ +\ j)\ \%\ size],roots\_ground\_truth[i])\ +\ std::numeric\_limits<fp\_t>::epsilon())),rel);}
\DoxyCodeLine{00524\ \ \ \ \ \}}
\DoxyCodeLine{00525\ \ \ \ \ max\_absolute\_error\ =\ abs;}
\DoxyCodeLine{00526\ \ \ \ \ max\_relative\_error\ =\ rel;}
\DoxyCodeLine{00527\ \ \ \ \ \textcolor{keywordflow}{return}\ rv;}
\DoxyCodeLine{00528\ \}}
\DoxyCodeLine{00529\ }
\DoxyCodeLine{00530\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
